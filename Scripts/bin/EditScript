#!/bin/bash
### has to be bash not sh so aliases are inherited.

source ScriptFunctions
Import GoboLinux
Import OptionParser
Import File
Import Log

### Options ###################################################################

scriptDescription="Create or edit a GoboLinux script."
scriptCredits="Copyright (C) 2001-2003 Hisham Muhammad - Released under the GNU GPL."
helpOnNoArguments=yes
scriptUsage="<script-name-with-no-path>"
scriptExample="$scriptName"
scriptNotes="You will be prompted if you want to create the script "\
"if it does not exist."
Parse_Options "$@"

### Operation #################################################################

if Is_Alias "$(Arg 1)"
then
   script=`alias $(Arg 1) | sed "s/.*'..//;s/'//"`
   echo $script
else
   script="$(Arg 1)"
fi

unset linkafteredit

scriptfile="${goboScripts}/${script}"

Is_Writable "${scriptfile}" || Verify_Superuser

if ! Exists "${scriptfile}"
then
    Ask_Continue "$scriptfile does not exist. Create? (Y/n)"
    today=`date +%d\\\/%m\\\/%Y`
    year=`date +%Y`
    cat "${goboScripts}/TemplateScript" | sed "s/INSERT_DATE_HERE/${today}/g;s/INSERT_YEAR_HERE/${year}/g" > "$scriptfile"
    chmod +x "$scriptfile"
    linkafteredit=yes
fi

$EDITOR "${scriptfile}"

[ "$linkafteredit" ] && {
    ln -s "${scriptfile}" "${goboExecutables}"
}

