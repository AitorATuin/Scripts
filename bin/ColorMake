#!/bin/sh

. ScriptFunctions
Import File
Import GoboLinux

# XXX "Real vs. rootless" support
if [ -x /bin/make ]
then makecmd=/bin/make
elif [ -x /usr/bin/make ]
then makecmd=/usr/bin/make
fi

if [ "$1" = "menuconfig" ]
then exec $makecmd "$@"
fi

workaround=`Temporary_File`

{ $makecmd "$@" 2>&1
  echo $? > $workaround
} | mtail --config="`Find_Conf ColorMake.mtailrc`" -q

returnvalue=`cat $workaround`
rm -- $workaround

exit $returnvalue
