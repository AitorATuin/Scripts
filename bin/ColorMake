#!/bin/sh

. ScriptFunctions
Import File
Import GoboLinux
Import Process

# XXX "Real vs. rootless" support
if [ -x /bin/make ]
then makecmd=/bin/make
elif [ -x /usr/bin/make ]
then makecmd=/usr/bin/make
fi

for i in "$@"
do
    if [ "$i" = "menuconfig" ]
    then exec $makecmd "$@"
    fi
done

workaround=`Temporary_File`

if Quiet which mtail; then
   { $makecmd "$@" 2>&1
     echo $? > $workaround
   } | mtail --config="`Find_Conf ColorMake.mtailrc`" -q

   returnvalue=`cat $workaround`
   rm -- $workaround

   exit $returnvalue
else
   Log_Terse "mtail not found. Unable to colorize output."
   $makecmd "$@"
fi
