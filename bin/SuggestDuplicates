#!/bin/bash
source ScriptFunctions
Import OptionParser

#
# parse options
scriptDescription="Check for non-current programs."
scriptCredits="Copyright 2005 MJ Ray. Released under GNU GPL v2."
helpOnNoArguments=""
scriptUsage=""
scriptExample=""
ScriptNotes="Provides a list of programs that are not linked to Current. It is not safe to assume these programs may be removed but rather they are not currently symlinked."
Parse_Options "$@"
#
#

function banner_top() {
    cat <<EOF
# SuggestDuplicates 1.2 - check for non-current installed versions
# (Copyright 2005 MJ Ray. Released under GNU GPL v2.)
#
EOF
}

function banner_bottom() {
    echo -e "#\n#End of list: ${1} not current"    
}

# Iterate over installed programs, reading Current symlink
find ${goboPrograms}/ -maxdepth 2 -mindepth 2 -name Current -printf '%P/%l\n' | \
sort | sed -e 's|/| |g' | \
{
    updates=0
    output=""
    while read prog cur ver junk ; do
	export prog
	for cver in $(find ${goboPrograms}/$prog -maxdepth 1 -type d -printf '%P ') ; do
        # output a suggestion if a dir isn't the current version or a special
	    case "$cver" in
		"$ver"|Settings|Current|Resources|Variable) 
		    ;;
		*)
		    if [ "${output}" ]; then 
			output="${output}\n${prog} ${cver}"
		    else
			output="${prog} ${cver}"
		    fi
		    updates=$(($updates + 1))
		    ;;
	    esac
	done 
    done

    banner_top
    echo -e $output
    banner_bottom $updates
}
